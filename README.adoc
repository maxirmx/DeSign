= Модуль `CadesSigner`

Модуль `CadesSigner` предоставляет функции для работы с сертификатами и цифровыми подписями файлов. Основное предназначение модуля – поиск сертификатов, подписывание файлов с использованием сертификатов и управление ошибками, возникающими в процессе работы с криптографическими операциями.

== Содержание

* <<Описание типов>>
* <<Исключения>>
* <<Функции>>

=== Описание типов

* `TBytes`: Массив байтов, используется для представления содержимого файла и других данных в байтовом формате.
* `T20Bytes`: Массив из 20 байтов, предназначенный для хранения SHA-1 хеш-суммы (отпечатка) сертификата.
* `TCertOption`: Запись, представляющая параметры сертификата.
  * `FriendlyName` - имя сертификата, используемое для отображения и выбора.
  * `Thumbprint` - уникальный идентификатор (отпечаток) сертификата, представленный в виде `T20Bytes`.

=== Исключения

* `ECertificateException`: Исключение, используемое для обработки ошибок при работе с сертификатами и криптографическими операциями.
  * `ErrorCode` - код ошибки из Windows API, который указывает на причину сбоя.

=== Функции

==== `GetCertificates`

[source,delphi]
----
function GetCertificates(const Prefix: string): TList;
----

Возвращает список сертификатов, доступных в системе, на основе указанного префикса `Prefix`.

* *Параметры*:
  ** `Prefix`: Строка, которая используется для фильтрации сертификатов по имени.

* *Результат*:
  ** Возвращает список сертификатов в виде `TList`, содержащий объекты `TCertOption`.

==== `SignFile`

[source,delphi]
----
function SignFile(const FilePath: string; const thumbprint: T20Bytes; const password: string): string;
----

Создает цифровую подпись для файла, используя указанный сертификат.

* *Параметры*:
  ** `FilePath`: Полный путь к файлу, который нужно подписать.
  ** `thumbprint`: Отпечаток (thumbprint) сертификата в формате `T20Bytes`, который будет использоваться для подписи.
  ** `password`: Пароль для доступа к сертификату.

* *Результат*:
  ** Возвращает путь к файлу с цифровой подписью.

=== Примеры использования

[source,delphi]
----
var
  CertList: TList;
  SignaturePath: string;
begin
  // Получение списка сертификатов с префиксом "Test"
  CertList := GetCertificates('Test');
  
  try
    // Подписание файла с использованием сертификата
    SignaturePath := SignFile('C:\Documents\example.pdf', thumbprint, 'password');
    Writeln('Подпись создана и сохранена в: ' + SignaturePath);
  finally
    CertList.Free;
  end;
end;
----

=== Ошибки

При возникновении ошибок во время операций с сертификатами и файлами модуль `CadesSigner` генерирует исключения типа `ECertificateException`, которые содержат сообщение об ошибке и код ошибки. Например, ошибка `ERR_OPEN_STORE_FAILED` указывает на невозможность открытия хранилища сертификатов.

---

Этот README описывает только публичный интерфейс модуля. Подробная документация по внутренним методам, используемым для обработки файлов и криптографических операций, доступна в исходном коде.
